# Example Parsec configuration showing different KeyManager options
# This demonstrates how to configure key managers for signed JWT transaction tokens

server:
  bind_address: "0.0.0.0:8443"
  tls:
    cert_file: "/path/to/cert.pem"
    key_file: "/path/to/key.pem"

trust_store:
  type: "stub_store"

# Example issuers using different KeyManager types
issuers:
  # Example 1: In-memory KeyManager (default, good for testing)
  # Keys are stored in memory and lost on restart
  - token_type: "urn:ietf:params:oauth:token-type:txn_token"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "5m"
    # If key_manager is omitted, defaults to memory KeyManager
    transaction_context:
      - type: "cel"
        expression: |
          {
            "user_id": subject.sub
          }
    request_context:
      - type: "cel"
        expression: "{}"

  # Example 2: Disk-based KeyManager (persists keys to filesystem)
  # Keys are stored on disk and survive pod restarts
  # Suitable for single-pod deployments with ReadWriteOnce persistent volumes
  - token_type: "urn:ietf:params:oauth:token-type:access_token"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "1h"
    key_manager:
      type: "disk"
      keys_path: "/var/lib/parsec/keys"
    transaction_context:
      - type: "cel"
        expression: |
          {
            "user_id": subject.sub,
            "org_id": subject.claims.org_id
          }
    request_context:
      - type: "cel"
        expression: "{}"

  # Example 3: AWS KMS KeyManager (uses AWS KMS for signing)
  # Requires AWS credentials to be configured (via env vars, IAM role, etc.)
  # Keys are managed by AWS KMS and can be rotated through AWS
  - token_type: "urn:x-custom:oauth:token-type:service_token"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "15m"
    key_manager:
      type: "aws_kms"
      # AWS region where KMS keys are located
      region: "us-west-2"
      # KMS alias prefix for key rotation (e.g., "alias/parsec/prod-")
      # Full alias will be: alias/parsec/prod-<timestamp>
      alias_prefix: "alias/parsec/prod-"
    transaction_context:
      - type: "cel"
        expression: |
          {
            "service_id": subject.sub,
            "environment": subject.claims.env
          }
    request_context:
      - type: "cel"
        expression: "{}"

  # Example 4: AWS KMS KeyManager with different region
  # Demonstrates using KMS in a different AWS region
  - token_type: "urn:ietf:params:oauth:token-type:jwt"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "10m"
    key_manager:
      type: "aws_kms"
      region: "us-east-1"
      alias_prefix: "alias/parsec/east-"
    transaction_context:
      - type: "cel"
        expression: |
          {
            "user_id": subject.sub
          }
    request_context:
      - type: "cel"
        expression: "{}"

  # Example 5: Another AWS KMS example with custom alias prefix
  # Can be used for different environments or services
  - token_type: "urn:ietf:params:oauth:token-type:id_token"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "30m"
    key_manager:
      type: "aws_kms"
      region: "eu-west-1"
      alias_prefix: "alias/parsec/eu-prod-"
    transaction_context:
      - type: "cel"
        expression: |
          {
            "user_id": subject.sub,
            "tenant": subject.claims.tenant_id
          }
    request_context:
      - type: "cel"
        expression: "{}"

data_sources: []

