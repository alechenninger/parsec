# Example Parsec configuration showing different KeyManager options
# This demonstrates how to configure key managers for signed JWT transaction tokens

server:
  bind_address: "0.0.0.0:8443"
  tls:
    cert_file: "/path/to/cert.pem"
    key_file: "/path/to/key.pem"

trust_store:
  type: "stub_store"

# Global key manager definitions
# Key managers can be shared across multiple issuers
key_managers:
  # In-memory KeyManager (default, good for testing)
  # Keys are stored in memory and lost on restart
  - id: "memory-km"
    type: "memory"
    key_type: "EC-P256"

  # Disk-based KeyManager (persists keys to filesystem)
  # Keys are stored on disk and survive pod restarts
  - id: "disk-km"
    type: "disk"
    key_type: "EC-P256"
    keys_path: "/var/lib/parsec/keys"

  # AWS KMS KeyManager for US West region
  # Requires AWS credentials (via env vars, IAM role, etc.)
  - id: "kms-us-west"
    type: "aws_kms"
    key_type: "EC-P256"
    region: "us-west-2"
    alias_prefix: "alias/parsec/prod-"

  # AWS KMS KeyManager for US East region
  - id: "kms-us-east"
    type: "aws_kms"
    key_type: "EC-P384"
    region: "us-east-1"
    alias_prefix: "alias/parsec/east-"

  # AWS KMS KeyManager for EU region
  - id: "kms-eu"
    type: "aws_kms"
    key_type: "EC-P256"
    region: "eu-west-1"
    alias_prefix: "alias/parsec/eu-prod-"

# Issuers reference key managers by ID
issuers:
  # Example 1: Using in-memory KeyManager
  - token_type: "urn:ietf:params:oauth:token-type:txn_token"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "5m"
    key_manager: "memory-km"
    transaction_context:
      - type: "cel"
        expression: |
          {
            "user_id": subject.sub
          }
    request_context:
      - type: "cel"
        expression: "{}"

  # Example 2: Using disk-based KeyManager
  - token_type: "urn:ietf:params:oauth:token-type:access_token"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "1h"
    key_manager: "disk-km"
    transaction_context:
      - type: "cel"
        expression: |
          {
            "user_id": subject.sub,
            "org_id": subject.claims.org_id
          }
    request_context:
      - type: "cel"
        expression: "{}"

  # Example 3: Using AWS KMS (US West)
  - token_type: "urn:x-custom:oauth:token-type:service_token"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "15m"
    key_manager: "kms-us-west"
    transaction_context:
      - type: "cel"
        expression: |
          {
            "service_id": subject.sub,
            "environment": subject.claims.env
          }
    request_context:
      - type: "cel"
        expression: "{}"

  # Example 4: Using AWS KMS (US East)
  - token_type: "urn:ietf:params:oauth:token-type:jwt"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "10m"
    key_manager: "kms-us-east"
    transaction_context:
      - type: "cel"
        expression: |
          {
            "user_id": subject.sub
          }
    request_context:
      - type: "cel"
        expression: "{}"

  # Example 5: Using AWS KMS (EU)
  - token_type: "urn:ietf:params:oauth:token-type:id_token"
    type: "transaction_token"
    issuer_url: "https://parsec.example.com"
    ttl: "30m"
    key_manager: "kms-eu"
    transaction_context:
      - type: "cel"
        expression: |
          {
            "user_id": subject.sub,
            "tenant": subject.claims.tenant_id
          }
    request_context:
      - type: "cel"
        expression: "{}"

data_sources: []

